<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äººç§°ä»£åè© æ¼”ç¿’</title>
    <link rel="stylesheet" href="./style.css">
</head>
<body>

    <h1 id="pageTitle">äººç§°ä»£åè© æ¼”ç¿’</h1>

    <div class="controls">
        <div class="level-group">
            <button class="level-btn active" onclick="app.setDifficulty(1)">Level 1</button>
            <button class="level-btn" onclick="app.setDifficulty(2)">Level 2</button>
            <button class="level-btn" onclick="app.setDifficulty(3)">Level 3</button>
        </div>
        <div class="mode-group">
            <label class="mode-label">
                <input type="radio" name="mode" value="basic" checked onchange="app.changeMode()">
                åŸºæœ¬ (3åˆ—)
            </label>
            <label class="mode-label">
                <input type="radio" name="mode" value="full" onchange="app.changeMode()">
                ã™ã¹ã¦ (5åˆ—)
            </label>
        </div>
    </div>

    <div id="messageArea"></div>

    <div class="table-container">
        <table id="quizTable"></table>
    </div>

    <div class="btn-container">
        <button id="checkBtn" class="action-btn" onclick="app.checkAnswers()">ç­”ãˆåˆã‚ã›</button>
        <button id="retryBtn" class="action-btn hidden" onclick="app.resetQuiz()">ã‚‚ã†ä¸€å›</button>
    </div>
    <div class="description">
        ãƒšãƒ¼ã‚¸ã®å†èª­ã¿è¾¼ã¿ï¼ˆãƒªãƒ­ãƒ¼ãƒ‰ï¼‰ã§ç©ºæ¬„ã¯å†é…ç½®ã•ã‚Œã¾ã™ã€‚<br>
        LevelãŒä¸ŠãŒã‚‹ã¨ç©ºæ¬„ãŒä½œã‚‰ã‚Œã‚„ã™ããªã‚‹ã‚ˆã†ã«è¨­å®šã—ã¦ã„ã¾ã™ã€‚
    </div>

<script>
    /**
     * ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã‚«ãƒ—ã‚»ãƒ«åŒ–ã—ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«æ±šæŸ“ã‚’é˜²ã
     */
    const app = (function() {
        
        // --- è¨­å®šãƒ‡ãƒ¼ã‚¿ ---
        // æ”¹è¡Œã¯ \n ã§è¡¨ç¾ã—ã€CSSã® white-space: pre-line ã§åæ˜ ã•ã›ã‚‹
        // ã“ã“ã‚’è¦‹ã¦ã„ã‚‹äººã¯ä»²é–“
        const config = {
            title: "äººç§°ä»£åè© æ¼”ç¿’",
            allColHeaders: ["ä¸»æ ¼", "ç›®çš„æ ¼", "æ‰€æœ‰æ ¼", "æ‰€æœ‰ä»£åè©", "å†å¸°ä»£åè©"],
            rowHeaders: [
                "1äººç§° å˜æ•°", "2äººç§° å˜æ•°", "3äººç§° å˜æ•°ï¼ˆç”·æ€§ï¼‰", "3äººç§° å˜æ•°ï¼ˆå¥³æ€§ï¼‰", "3äººç§° å˜æ•°ï¼ˆç‰©ãƒ»äº‹ï¼‰",
                "1äººç§° è¤‡æ•°", "2äººç§° è¤‡æ•°", "3äººç§° è¤‡æ•°"
            ],
            allData: [
                ["I",    "me",   "my",    "mine",   "myself"],
                ["you",  "you",  "your",  "yours",  "yourself"],
                ["he",   "him",  "his",   "his",    "himself"],
                ["she",  "her",  "her",   "hers",   "herself"],
                ["it",   "it",   "its",   "-",      "itself"],
                ["we",   "us",   "our",   "ours",   "ourselves"],
                ["you",  "you",  "your",  "yours",  "yourselves"],
                ["they", "them", "their", "theirs", "themselves"]
            ]
        };

        const difficultyRates = {
            1: 0.15, // å°‘ã—ä¸Šã’ã‚‹(è©°ã¿é˜²æ­¢ãƒ­ã‚¸ãƒƒã‚¯ãŒå…¥ã‚‹ãŸã‚)
            2: 0.35, 
            3: 0.60  
        };

        let currentLevel = 1;
        let currentMode = 'basic'; 

        // --- DOMè¦ç´ å–å¾—ãƒ˜ãƒ«ãƒ‘ãƒ¼ ---
        const getEl = (id) => document.getElementById(id);

        function init() {
            getEl('pageTitle').textContent = config.title;
            resetQuiz();
        }

        function setDifficulty(level) {
            currentLevel = level;
            document.querySelectorAll('.level-btn').forEach((btn, index) => {
                if (index + 1 === level) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            resetQuiz();
        }

        function changeMode() {
            const radios = document.getElementsByName('mode');
            for (const radio of radios) {
                if (radio.checked) {
                    currentMode = radio.value;
                    break;
                }
            }
            resetQuiz();
        }

        function resetQuiz() {
            // UIãƒªã‚»ãƒƒãƒˆ
            const msgArea = getEl('messageArea');
            msgArea.style.display = 'none';
            msgArea.className = '';
            msgArea.textContent = '';
            
            getEl('checkBtn').classList.remove('hidden');
            getEl('retryBtn').classList.add('hidden');

            const table = getEl('quizTable');
            // innerHTML="" ã¯å­è¦ç´ å‰Šé™¤ã®é«˜é€Ÿãªæ‰‹æ®µã¨ã—ã¦è¨±å®¹ã•ã‚Œã‚‹ãŒã€
            // å¿µã®ãŸã‚ãƒ«ãƒ¼ãƒ—å‰Šé™¤ã«ã™ã‚‹ãªã‚‰ while(table.firstChild) table.removeChild(table.firstChild);
            table.textContent = ''; 

            const colCount = (currentMode === 'basic') ? 3 : 5;
            
            // --- ãƒ˜ãƒƒãƒ€ãƒ¼ç”Ÿæˆ (document.createElementä½¿ç”¨) ---
            const thead = document.createElement('tr');
            thead.appendChild(document.createElement('th')); // å·¦ä¸Š
            
            for (let i = 0; i < colCount; i++) {
                const th = document.createElement('th');
                th.textContent = config.allColHeaders[i]; // HTMLã‚¿ã‚°ã¯è§£é‡ˆã•ã‚Œãªã„(å®‰å…¨)
                thead.appendChild(th);
            }
            table.appendChild(thead);

            // --- ãƒ‡ãƒ¼ã‚¿è¡Œç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ ---
            const rate = difficultyRates[currentLevel];
            let tableRows = [];
            let totalBlanks = 0;
            let attempts = 0;

            do {
                tableRows = [];
                totalBlanks = 0;
                attempts++;

                config.allData.forEach((fullRowData, rIndex) => {
                    let rowCells = [];
                    let rowBlankCount = 0;

                    for (let cIndex = 0; cIndex < colCount; cIndex++) {
                        const cellData = fullRowData[cIndex];
                        let isBlank = false;
                        
                        if (cellData !== "-") {
                            // å°†æ¥çš„ã«ã€Œæ‰€æœ‰æ ¼ã ã‘ç©´åŸ‹ã‚ã€ç­‰ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹ãªã‚‰ã“ã“ã§åˆ¤å®š
                            if (Math.random() < rate) {
                                isBlank = true;
                                rowBlankCount++;
                                totalBlanks++;
                            }
                        }
                        rowCells.push({
                            text: cellData,
                            isBlank: isBlank,
                            r: rIndex,
                            c: cIndex
                        });
                    }

                    // è¡Œã™ã¹ã¦ãŒç©ºæ¬„(rowBlankCount === colCount)ã«ãªã£ã¦ã—ã¾ã£ãŸå ´åˆã€
                    // ãƒ©ãƒ³ãƒ€ãƒ ã«1ã¤ã ã‘ç©ºæ¬„ã‚’è§£é™¤ã™ã‚‹ï¼ˆãƒ’ãƒ³ãƒˆã‚’æ®‹ã™ï¼‰
                    if (rowBlankCount === colCount && colCount > 0) {
                         // ç©ºæ¬„ã«ãªã£ã¦ã„ã‚‹ã‚»ãƒ«ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ¢ã™
                         const blankIndices = rowCells
                            .map((cell, idx) => cell.isBlank ? idx : -1)
                            .filter(idx => idx !== -1);
                         
                         if (blankIndices.length > 0) {
                             // ãƒ©ãƒ³ãƒ€ãƒ ã«1ã¤é¸ã‚“ã§å¯è¦–åŒ–
                             const rescueIndex = blankIndices[Math.floor(Math.random() * blankIndices.length)];
                             rowCells[rescueIndex].isBlank = false;
                             totalBlanks--; 
                         }
                    }

                    tableRows.push(rowCells);
                });
                
            } while (totalBlanks < 2 && attempts < 100);

            // --- DOMæç”» (innerHTMLä¸ä½¿ç”¨) ---
            tableRows.forEach((rowCells, rIndex) => {
                const tr = document.createElement('tr');
                
                const rowHead = document.createElement('td');
                rowHead.classList.add('row-header');
                rowHead.textContent = config.rowHeaders[rIndex];
                tr.appendChild(rowHead);

                rowCells.forEach(cell => {
                    const td = document.createElement('td');
                    
                    if (cell.text === "-") {
                        td.textContent = "-";
                    } else if (cell.isBlank) {
                        const input = document.createElement('input');
                        input.type = "text";
                        input.dataset.r = cell.r;
                        input.dataset.c = cell.c;
                        input.autocomplete = "off";
                        td.appendChild(input);
                    } else {
                        td.textContent = cell.text;
                    }
                    tr.appendChild(td);
                });
                table.appendChild(tr);
            });

            // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹åˆ¶å¾¡
            const firstInput = table.querySelector('input[type="text"]');
            if (firstInput && window.innerWidth > 600) { 
                firstInput.focus(); 
            }
        }

        function checkAnswers() {
            const inputs = document.querySelectorAll('input[type="text"]');
            let correctCount = 0;
            let totalCount = inputs.length;

            if (totalCount === 0) return;

            inputs.forEach(input => {
                const r = input.dataset.r;
                const c = input.dataset.c;
                const correctVal = config.allData[r][c];
                const userVal = input.value.trim();
                const parentTd = input.parentElement;

                input.disabled = true;

                // innerHTMLã‚’ä½¿ã‚ãšã€ãƒ†ã‚­ã‚¹ãƒˆãƒãƒ¼ãƒ‰æ“ä½œã§æ›´æ–°
                if (userVal.toLowerCase() === correctVal.toLowerCase()) {
                    parentTd.textContent = correctVal; 
                    parentTd.classList.add('correct-cell');
                    correctCount++;
                } else {
                    parentTd.classList.add('incorrect-cell');
                    // ãƒ’ãƒ³ãƒˆè¦ç´ ã‚‚createElementã§ä½œã‚‹
                    const hint = document.createElement('div');
                    hint.classList.add('answer-hint');
                    hint.textContent = `(${correctVal})`;
                    parentTd.appendChild(hint);
                }
            });

            getEl('checkBtn').classList.add('hidden');
            getEl('retryBtn').classList.remove('hidden');

            if (correctCount >= (totalCount - 1)) {
                const msgArea = getEl('messageArea');
                if (correctCount === totalCount) {
                    msgArea.textContent = "ğŸ‰ Perfect!! å…¨å•æ­£è§£ã§ã™ï¼ ğŸ‰";
                    msgArea.className = 'msg-success';
                } else if (totalCount >= 2 && correctCount === (totalCount - 1)) {
                    msgArea.textContent = "æƒœã—ã„ï¼ ã‚ã¨1å•ã§ã™ï¼";
                    msgArea.className = 'msg-veryclose';
                }
                msgArea.style.display = 'block';
            }
        }

        // å¤–éƒ¨ã‹ã‚‰å‘¼ã¹ã‚‹é–¢æ•°ã‚’å…¬é–‹
        return {
            init,
            setDifficulty,
            changeMode,
            resetQuiz,
            checkAnswers
        };

    })();

    // èµ·å‹•
    app.init();
</script>

</body>
</html>
